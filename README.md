# Contrastive-Learning-for-SceneSeparation

これまでのルールベースのシーン分離手法はフレームの特徴量抽出にImageNetで事前学習したVGG16やResNet50を使用していた。\
しかしImageNetは1000個の離散カテゴリの画像データセットであり、動画のシーン分離検出で必要となる時系列情報を考慮していない。\
それを検証するために、ImageNetのVGG16やResNet50による埋め込みをt-SNEで可視化を行った結果、予想通り無関係なシーンデータ同士が中央の比較的近くに集合してしまう状況が発生していた。\
この状況はルールベース処理で埋め込みを使って閾値によるシーンの分離を行う際に、無関係なシーン画像がまとめて認識され性能低下をもたらすと考えられる。\
したがって今回はこの画像の埋め込み器に、時系列関係を考慮した独自の学習手法を適用し、シーン分離性能改善につながるかを検証した。\
## 時系列情報を考慮した対照学習
本学習手法は以下の図の通りです。
まず、訓練データの中から2つのシーンをランダムに選択し、1つのシーンから2つのフレームをランダムに抽出し、もう一つのシーンからはランダムに1枚抽出する。
そして、2枚抽出したシーンの画像の1枚をアンカー画像とし、もう1枚を同一シーンから抽出したフレームなのでpos画像とする。
別のシーンからの1枚はneg画像とする。
anchorの埋め込みベクトルに対してposの埋め込みベクトルの類似度を近づけるように、negの埋め込みベクトルの類似度は遠ざけるように埋め込み器を学習する。

![image](https://user-images.githubusercontent.com/55880071/185697419-ea60684d-a4cf-4471-9bba-038b0eb9091d.png)

## 埋め込み可視化結果の比較
以下は任意の動画の全フレームをVGG16の従来手法とVgg16の本手法で埋め込みをそれぞれ行い、t-SNEで次元削減して可視化した図である。
従来手法では、中心に集中していたり、外部に外れ値のようなものが観測されるが、提案手法では集中度合いは減少し、外れ値はなくなった。
画像中の数字はフレーム番号である。

従来手法によるベクトルをt-SNEで次元削減したもの\
![ダウンロード (1)wetgeg](https://user-images.githubusercontent.com/55880071/185693909-de696ed7-fb00-42ae-b82e-4cb6eb4c1915.png)

提案手法によって抽出されたベクトルをt-SNEで次元削減したもの
![ダウンロード](https://user-images.githubusercontent.com/55880071/185745671-3aa24bb8-3242-461f-8bd2-0c95a11bd02d.png)

## 評価
ImageNetで事前学習したVGG16をbackboneに使用している従来手法( https://github.com/tsutsui-439f340f/Scene-Separation-Detection-rule-based )と比較すると、正解率と未検出数を維持した状態で、誤検出数をかなり減らしていることが分かる。
一方、ImageNetで事前学習したResNet50をbackboneに使用しているモデルでは、すべてのシステムで性能が下がった。\

backbone-VGG16
|  システム  |  正解率  | 誤検出数 | 未検出数|
| ---- | ---- | ---- | ---- |
| ルールベース処理(ImageNet pre-trained)  | 0.995 | 404 | 3 |
| ルールベース処理(ImageNet pre-trained)+後処理| 0.968 | 158 | 20 |
| ルールベース処理(CL)  | 0.975 | 225 | 16 |
| ルールベース処理(CL)+後処理| 0.961 | 86 | 25 |

backbone-ResNet50

|  システム  |  正解率  | 誤検出数 | 未検出数|
| ---- | ---- | ---- | ---- |
| ルールベース処理(ImageNet pre-trained)  | 0.981 | 88 | 12 |
| ルールベース処理(ImageNet pre-trained)+後処理| 0.970 | **47** | **19** |
| ルールベース処理(CL)  | 0.951 | 117 | 31 |
| ルールベース処理(CL)+後処理| 0.948 | 82 | 33 |
